USE EXAMPLE3;

CREATE TABLE locations (
    location_id INT PRIMARY KEY,
    city VARCHAR(50)
);

CREATE TABLE departments (
    department_id INT PRIMARY KEY,
    department_name VARCHAR(50),
    location_id INT,
    FOREIGN KEY (location_id) REFERENCES locations(location_id)
);

CREATE TABLE employees (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    salary DECIMAL(10, 2),
    department_id INT,
    FOREIGN KEY (department_id) REFERENCES departments(department_id)
);

INSERT INTO locations (location_id, city) VALUES
(1, 'New York'),
(2, 'Los Angeles'),
(3, 'Chicago');

INSERT INTO departments (department_id, department_name, location_id) VALUES
(101, 'HR', 1),
(102, 'IT', 2),
(103, 'Finance', 3),
(104, 'Marketing', 1);

INSERT INTO employees (employee_id, name, salary, department_id) VALUES
(1, 'Alice', 75000, 101),
(2, 'Bob', 85000, 102),
(3, 'Charlie', 65000, 103),
(4, 'David', 90000, 102),
(5, 'Eva', 72000, 104),
(6, 'Frank', 82000, 101),
(7, 'Grace', 60000, 104);

SELECT * FROM LOCATIONS;

SELECT * FROM DEPARTMENTS;

SELECT * FROM EMPLOYEES;

-- 1
SELECT NAME,SALARY,DEPARTMENT_ID
FROM EMPLOYEES E1
WHERE SALARY = (
	SELECT MAX(SALARY) 
    FROM EMPLOYEES E2
    WHERE E2.DEPARTMENT_ID = E1.DEPARTMENT_ID
);
-- 
SELECT NAME,SALARY,DEPARTMENT_ID
FROM EMPLOYEES E1
WHERE SALARY > (
	SELECT AVG(SALARY)
    FROM EMPLOYEES E2
    WHERE E2.DEPARTMENT_ID =  E1.DEPARTMENT_ID
);

INSERT INTO DEPARTMENTS (DEPARTMENT_ID,DEPARTMENT_NAME) VALUES (105,"BUSINESS");
SELECT * FROM DEPARTMENTS;

--
SELECT DEPARTMENT_ID FROM DEPARTMENTS;
SELECT DEPARTMENT_ID FROM EMPLOYEES;

SELECT DEPARTMENT_NAME,DEPARTMENT_ID
FROM DEPARTMENTS
WHERE DEPARTMENT_ID NOT IN (
	SELECT DEPARTMENT_ID FROM EMPLOYEES
);

--
SELECT LOCATION_ID FROM LOCATIONS WHERE CITY LIKE "C%";
SELECT DEPARTMENT_ID FROM DEPARTMENTS WHERE LOCATION_ID = 3;

SELECT NAME
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN (
	SELECT DEPARTMENT_ID
    FROM DEPARTMENTS
    WHERE LOCATION_ID IN (
		SELECT LOCATION_ID FROM LOCATIONS WHERE CITY LIKE "C%"
    )
);

--
SELECT NAME,DEPARTMENT_ID
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN (
	SELECT DEPARTMENT_ID 
    FROM EMPLOYEES
    GROUP BY DEPARTMENT_ID
    HAVING COUNT(*) > 1
);

SELECT * FROM EMPLOYEES;
